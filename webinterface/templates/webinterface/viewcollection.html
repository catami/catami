{% extends "base-topmenu.html" %}
{% block title %}{{ block.super }} : {{ request.path }}{% endblock %}
{% block tail_head %}
<style type="text/css">
    .viewpane {
        padding-left: 10px;
        border-left-style: solid;
        border-left-width: 1px;
        border-color: #ddd;
    }
    .viewobj {
        border-style: solid;
        border-width: 2px;
        border-color: #ddd;
    }
    .workpane {
        width: 99%;
        margin:0;
    }
    input[type='number']{
        padding: 0px;
        margin: 0px;
        width: 40px;
    }
    /*
    .nav-tabs li a {
        background-color: #ddd;
        color: #3a3a3a;
    }
    */
    .sidepanel {
        padding:5px;
    }
    .sidepanel hr {
        padding:0;
        margin: 0;
    }
</style>
<link rel="stylesheet" href="{{ STATIC_URL }}assets/catami-api/css/collections.css" type="text/css">
{% endblock %}
{% block content %}
<div class="row-fluid">

<div class="span2">
    Collection: <span class="pull-right"><a href="#_" id="showCollectionMapLink" onclick="updateMapForSelectedCollection({{ collection_id }});">map</a></span>
    <div id="cl-info" class="well sidepanel">
    </div>
    Workset:<span class="pull-right"><a href="#_" id="clearWorksetLink"></a> &nbsp; <a href="#map" data-toggle="tab" id="showWorksetMapLink"></a></span>
    <div class="well sidepanel" style="padding:5px;">
        <div id="ws-info"></div><hr>
        <div id="ws-list"></div>
{#        {% with "Workset" as clname %}#}
{#            {% include "webinterface/dataviews/worksetlists.html"%}#}
{#        {% endwith %}#}
    </div>
</div>

<div class="span10 viewpane" >

    
    <ul class="nav nav-tabs">
        <li class="active"><a href="#map" data-toggle="tab"><i class="icon-globe"></i> Map</a></li>
        <li><a href="#thm" data-toggle="tab"><i class="icon-eye-open"></i> Thumbnails</a></li>
        <li><a href="#tax" data-toggle="tab">Taxonomy</a></li>
        <li><a href="#cst" data-toggle="tab"><i class="icon-cog"></i> Visual Clusters</a></li>
        <li class="pull-right"><a href="#dwn" data-toggle="tab"><i class="icon-download-alt"></i> Download</a></li>
        <li class="pull-right"><a href="#ant" data-toggle="tab"><i class="icon-tag"></i> Annotate</a></li>
        <li class="pull-right"><a href="#cls" data-toggle="tab"><i class="icon-sitemap"></i> Classify</a></li>
    </ul>


    <div class="tab-content">
        <div class="tab-pane active" id="map">
            {% include "webinterface/dataviews/mapview.html"%} 
        </div>
        <div class="tab-pane" id="tax">
            {% include "webinterface/dataviews/taxonomytree.html"%} 
        </div>
        <div class="tab-pane" id="cst">
			{% include "webinterface/dataviews/clusterview.html"%} 
		</div>
        <div class="tab-pane" id="thm">
            {% include "webinterface/dataviews/thumbnails.html"%}
        </div>
        <div class="tab-pane" id="ant">
            This will give options to continue or create an annotation run on the selected Workset.<br>
            <a href="{% url webinterface.views.image_annotate %}" class="btn btn-primary imageframe" data-fancybox-group="annotationlist" data-fancybox-type="iframe" rel="tooltip" title="Annotate Workset1"><i class="icon-tag"></i> Annotate!</a>
        </div>
        <div class="tab-pane" id="cls">
            Classify
        </div>
        <div class="tab-pane" id="dwn">
        	This will contain options for downloading a variety of different combinations the data.
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block add_script %}
    <script type="text/javascript" src="{{ STATIC_URL }}assets/catami-api/js/collections.js"></script>
    <script type="text/javascript">

    /*// Collection info object
    clinfo = new CollectionInfo();

    // Instantiate workset list object
    wslist = new Collection({select_fnc : 'selectWorkset'});*/


    // Instantiate collection list object
    wslist = new CollectionAPI({
        settings : {
            radio_fnc : 'selectWorkset({0})'
        },
        config   : {
            itemorder : 'radio,name,creation_info',
            format    : 'cl-list-navbar',
            nested    : false
        }
    });

    // Collection info object
    //clinfo = new CollectionInfo();
    clinfo = new CollectionAPI({
        config : {
            itemorder : 'info,name,creation_info,description',
            format    : 'cl-info-navbar',
            nested    : false
        }
    });





    $(document).ready(function(){
        getNewImageList('collection={{ collection_id }}');
        //initDeploymentMap ();
        //setCollectionProperties({{ collection_id }},'#Collection-properties');
        clinfo.getCollectionInfo({{ collection_id }},'#cl-info');
        $('.cldescription').shorten({showChars : 50});          // Shorten descriptions for nicer display

        //setWorksetLists({{ collection_id }});
        wslist.getCollectionList('parent={{ collection_id }}', '#ws-list')
        //wslist.getWorksetList("", {{ collection_id }}, "#ws-list");   // Get workset list

        initDeploymentMap();
        updateMapForSelectedCollection({{ collection_id }});

        {% if workset_id %}
            selectWorkset({{ workset_id }});
        {% endif %}
    });

    function selectWorkset(id) {
        getNewImageList('collection='+id);
        clinfo.getCollectionInfo(id,'#ws-info');
        updateMapForSelectedCollection(id);

        $('#clearWorksetLink').html('clear');

        // TODO: this is a hack - it should be a map layer
        $('#showWorksetMapLink').attr('onClick','updateMapForSelectedCollection('+id+');');
        $('#showWorksetMapLink').html('map');
    }

    </script>
{% endblock %}  
