{% extends "base-topmenu.html" %}
{% block title %}{{ block.super }} : {{ request.path }}{% endblock %}
{% block tail_head %}
<style type="text/css">
    body {
        padding: 10px;
    }
    img {
        width: 99%;
        height: auto;
    }
    /*select, button {
        vertical-align: top;
    }*/
    td {
        vertical-align: middle;
    }
    .viewpane {
        padding-left: 10px;
        border-left-style: solid;
        border-left-width: 1px;
        border-color: #ddd;
    }
    .viewobj {
        border-style: solid;
        border-width: 2px;
        border-color: #ddd;
    }
    .workpane {
        width: 99%;
        margin:0;
    }
    input[type='number']{
        padding: 0px;
        margin: 0px;
        width: 40px;
    }
    #map_container2 { height: 600px; width: 100%; border:2px;}
    img.olTileImage { max-width: 256px !important; }
</style>
{% endblock %}
{% block content %}
<div class="row-fluid">

<div class="span2"> 
    <h3>Search:</h3>

    <form>
        <label>
            Year: 
            <input type="number" min="2006" step="1"
            value="2007">
        </label>
        Source:
        <select style="width: 100%">
            <option selected>AUV
            <option>BRUVs
            <option>Towed Video
        </select>
    	Campaign:
        <select name="campaignSelect" multiple="multiple" class="workpane" id="campaignSelect" onchange="selectCampaign($(this).val());">
        	<!-- Content inserted from jqery -->
        </select>
    	Deployments:
        <select name="deploymentSelect" multiple="multiple" class="workpane" id="deploymentSelect"  onchange="selectDeployment($(this).val());">
        	<!-- Content inserted from jqery -->
        </select>
    	Depth (min): <br>
        0 <input style="width: 50%" type="range" min="0" max="1000" value="100" id="drange"> 1000m <br>
    	Depth (max): <br>
        0 <input style="width: 50%" type="range" min="0" max="1000" value="600" id="drange"/> 1000m
    </form>
    <div> 
        <button class="btn btn-primary">Save Collection</button>
    </div>

</div>

<div class="span10 viewpane" >

    
    <ul class="nav nav-tabs">
        <li class="active"><a href="#map" data-toggle="tab">Map</a></li>
        <li><a href="#thm" data-toggle="tab">Thumbnails</a></li>
        <li><a href="#tax" data-toggle="tab">Taxonomy</a></li>
    </ul>


    <div class="tab-content">

        <div class="tab-pane active" id="map">
            <!--{% include "webinterface/dataviews/mapview.html"%}-->
			<div id='map_container2'></div>
        </div>

        <div class="tab-pane" id="tax">
            {% include "webinterface/dataviews/taxonomytree.html"%}
        </div>
        
        <div class="tab-pane" id="thm">
            {% include "webinterface/dataviews/thumbnails.html"%}
        </div>

       

    </div>
</div>
</div>

{% endblock %}

{% block add_script %}		
<script type="text/javascript">
    $(document).ready(function() {
  		getDeploymentList();
  		getCampaignList();
	});

	function selectCampaign(id) {
		getDeploymentList(id);
		getImageList("/api/dev/image/?format=json&limit=30&campaign="+id,1);
		//alert('Selected campaign id: '+id);
	}
	
	function selectDeployment(id) {
		getImageList("/api/dev/image/?format=json&limit=30&deployment="+id,1);
		//alert('Selected deployment id: '+id);
	}
	
    function getDeploymentList(cmpid) {
		var apiurl = "/api/dev/deployment/?format=json";
		
		// apply filter if campaign id is valid
		if (!isNaN(cmpid) && cmpid!="") {
			apiurl += "&campaign="+cmpid;
		}
		
		$.getJSON(apiurl , function(dpl){
			//alert ('L: ' + j.objects.length);
			var options = '';
			for (var i = 0; i < dpl.objects.length; i++) {
				options += '<option value="' + dpl.objects[i].id + '">' + dpl.objects[i].short_name + '</option>';
			}
			$("#deploymentSelect").html(options);
			//$('#deploymentSelect option:first').attr('selected', 'selected');
		})
	}
	function getCampaignList() {
		var apiurl = "/api/dev/campaign/?format=json";
		$.getJSON(apiurl , function(cmp){
			//alert ('L: ' + j.objects.length);
			var options = '<option value="">--ALL--</option>';
			for (var i = 0; i < cmp.objects.length; i++) {
				options += '<option value="' + cmp.objects[i].id + '">' + cmp.objects[i].short_name + '</option>';
			}
			$("#campaignSelect").html(options);
			//$('#deploymentSelect option:first').attr('selected', 'selected');
		})
	}
	
</script>

<script src='{{ STATIC_URL }}assets/openlayers/OpenLayers.js'></script>
<script src='{{ STATIC_URL }}assets/esriOceanBasemap/map.js'></script>
<script type="text/javascript">
    var lon = 138;
    var lat = -35;
    var zoom = 4;
    var map, layer;
    var bounds;

 	var style ={
   		strokeColor: "#00FF00",
   		strokeOpacity: 1,
   		strokeWidth: 3,
   		fillColor: "#00FF00",
   		fillOpacity: 0.8 };
       
	function init(){

		var geojson_payload = '{ "type": "FeatureCollection", "features": [ {"geometry": { "type": "GeometryCollection", "geometries": [\
{% for campaign_rect in campaign_rects %}{% if not forloop.last %}{{campaign_rect|safe}},{% else %}{{campaign_rect|safe}}{% endif %}{% endfor %}] }, "type": "Feature", "properties": {}} ] }';

       var geojson_format = new OpenLayers.Format.GeoJSON();
       var feature_collection = geojson_format.read(geojson_payload);
       
        map = new OpenLayers.Map('map_container2');
        layer = new OpenLayers.Layer.WMS( "OpenLayers WMS", 
                "http://vmap0.tiles.osgeo.org/wms/vmap0",
                {layers: 'basic'} );
        
        map.addLayer(layer);
        
        var vector_layer = new OpenLayers.Layer.Vector(); 
        map.addLayer(vector_layer);
        vector_layer.addFeatures(geojson_format.read(geojson_payload));
           
        map.setCenter(new OpenLayers.LonLat(lon, lat), zoom);
        
	}
</script>
{% endblock %}
