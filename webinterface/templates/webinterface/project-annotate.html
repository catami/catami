{% extends "base-topmenu.html" %}
{% block title %}Catami Project - Project List {% endblock %}

{% block content %}

    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}assets/css/elastislide/elastislide.css" />
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}assets/css/elastislide/custom.css" />
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}assets/css/elastislide/custom.css" />
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}assets/catami-api/css/bootstrapSwitch.css"/>
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}assets/css/annotation_accordion.css" />
	
    <style type="text/css">
        div.wrapper{
		    float:left; /* important */
		    position:relative; /* important(so we can absolutely position the description div */
		}
		div.description{
		    position:absolute; /* absolute position (so we can position it where we want)*/
		    bottom:5px;
		    left:0px;
		    width:100%;
		    background-color:rgba(0,0,0,0.2);
		    font-family: 'helvetica';
		    font-size:15px;
		    color:white;
		    font-weight: bold;
		    text-align: center;
		}
		
        #ImageContainer {
            position: relative;
            margin-top: 10px;
            /*margin-right: 510px;*/
        }

        #ImageContainer span {
            position: absolute;
            margin: 0px;
        }

        #Image {
            /*display: block;*/
            margin: 0px;
            position: relative;
        }

        .pointAnnotated {
        	-moz-box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8), 0px 0px 3px rgba(0,0,0,0.8);
			-webkit-box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8),  0px 0px 3px rgba(0,0,0,0.8);
			box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8), 0px 0px 3px rgba(0,0,0,0.8);
            min-width: 12px;
            min-height: 12px;
		    background-color:rgba(20,237,24,0.0);
		    border: 2px solid #fff;
			border-top-left-radius: 25%;
			border-top-right-radius: 25%;
			border-bottom-left-radius: 25%;
			border-bottom-right-radius: 25%;
			color: #fff;
			text-shadow: 0px 0px 3px rgba(0,0,0,0.8);
        }


	    .pointNotAnnotated {
        	-moz-box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8), 0px 0px 3px rgba(0,0,0,0.8);
			-webkit-box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8),  0px 0px 3px rgba(0,0,0,0.8);
			box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8), 0px 0px 3px rgba(0,0,0,0.8);
            width: 12px;
            height: 12px;
		    background-color:rgba(32,103,235,0.1);
		    border: 1px solid #fff;
		}
		
		@-webkit-keyframes rotation {
		    from {-webkit-transform: rotate(0deg);}
		    to   {-webkit-transform: rotate(359deg);}
		}
		
		.pointSelected {
        	-moz-box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8), 0px 0px 3px rgba(0,0,0,0.8);
			-webkit-box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8),  0px 0px 3px rgba(0,0,0,0.8);
			box-shadow:inset 0px 0px 3px rgba(0,0,0,0.8), 0px 0px 3px rgba(0,0,0,0.8);
            -webkit-animation: rotation 2s infinite linear;
            width: 12px;
            height: 12px;
		    background-color:rgba(240,206,9,0.1);
		    border: 2px dashed #fff;
			border-top-left-radius: 50%;
			border-top-right-radius: 50%;
			border-bottom-left-radius: 50%;
			border-bottom-right-radius: 50%;        
		}

    </style>

    <!-- elastislide thumbnail div -->
	<div class="row-fluid">
        <div id="ProjectAnnotateContainer"></div>
    </div>

    <div class="row-fluid">

        <div class="span9" id="ImageContainer"></div>

        <div class="span3" style="margin-top: 10px;">

            <div id="ChooseAnnotationContainer" ></div>

        </div>

	</div>
	
    <script type="text/template" id="ChooseAnnotationTemplate">

        <div class="well">
            <a id="hide_points_button" class="btn">Hide Points (click and hold me)</a>

           <!-- <div class="btn-group" data-toggle="buttons-checkbox">
                <button id="ZoomToggle" type="button" class="btn" >Zoom Toggle</button>

            </div>-->
            <button id="ZoomToggle" type="button" class="btn" data-toggle="button">Zoom Toggle</button>
        </div>

    	<div id="annotation-chooser"></div>

         <div>
                <h3>Image Labels</h3>
                <ul id="LabelPils" class="nav nav-pills"></ul>
            </div>
	</script>
	
    <script type="text/template" id="ProjectAnnotateTemplate">
        <div class="row-fluid">
            <div class="span12">
                <ul class="breadcrumb">

                    <li><a href="/projects/">Projects</a> <span
                            class="divider">></span></li>
                    <li><a href="/projects/<%=id%>/" ><%= name %></a> <span
                            class="divider">></span></li>
                    <li class="active">Annotate</li>

                </ul>
            </div>
        </div>

        <div class='row-fluid'>
            <div class="span12 thumbnail-pane catami-slide" id ="thumbnail-pane">
                <ul id='carousel' class='elastislide-list'>
                    <%=thumbnails%>
                </ul>
            </div>
        </div>
    </script>

    <script type="text/template" id="ThumbnailTemplate">
        <li><div class='wrapper'><a href='#'><div class='description'></div><img src='<%= thumbnail_location %>' data-src='<%= thumbnail_location %>' alt='image'></a></div></li>
    </script>

    <script type="text/template" id="ImageTemplate">
        <img id="Image" src='<%= web_location %>' data-src='<%= web_location %>' alt='image'>
    </script>

    <script src="{{ STATIC_URL }}assets/jquery/modernizr.custom.17475.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/jquery/jquery.elastislide.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/jpages/js/jPages.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/backbone/templates/project-model.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/backbone/templates/point-annotation-model.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/backbone/templates/annotationset-model.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/backbone/templates/project-annotate-view.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/jquery/plugins/jquery.imagesloaded.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/jquery/plugins/jquery.accordion.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/jquery.elevatezoom/jquery.elevateZoom-2.5.5.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}assets/bootstrap/js/bootstrap-button.js"></script>

    <script type="text/javascript">

        var projectId = "{{ project_id }}";

        var points = new PointAnnotations();
        var annotationSets = new AnnotationSets();
        var project = new Project({"id": projectId});
        var annotationCodeList = new AnnotationCodeList();
        //var nested_annotation_list;

        annotationSets.fetch({
            data: { project: projectId },
            success: function (model, response, options) {

                project.fetch({
                    success: function (model, response, options) {

                        annotationCodeList.fetch({
                            data: {limit: 500},
                            success: function (model, response, options) {


                                //load the views
                                var projectAnnotateView = new ProjectAnnotateView({
                                    el: $("#ProjectAnnotateContainer"),
                                    model : annotationSets
                                });

                                var imagesAnnotateView = new ImageAnnotateView({
                                    el: $("#ImageContainer"),
                                    model : annotationSets
                                });

                                //trigger an event for selecting the first thumbanil in the list
                                GlobalEvent.trigger("thumbnail_selected", 0);
                            },
                            error: function (model, response, options) {
                                $.pnotify({
                                    title: 'Failed to load the annotation code list. Try refreshing the page.',
                                    text: response.status,
                                    type: 'error', // success | info | error
                                    hide: true,
                                    icon: false,
                                    history: false,
                                    sticker: false
                                });
                            }
                        });
                    },
                    error: function (model, response, options) {
                        $.pnotify({
                            title: 'Failed to load the project details. Try refreshing the page.',
                            text: response.status,
                            type: 'error', // success | info | error
                            hide: true,
                            icon: false,
                            history: false,
                            sticker: false
                        });
                    }
                });
            },
            error: function (model, response, options) {
                $.pnotify({
                    title: 'Failed to load the annotation set details. Try refreshing the page.',
                    text: response.status,
                    type: 'error', // success | info | error
                    hide: true,
                    icon: false,
                    history: false,
                    sticker: false
                });
            }
       
        });

        var chooseAnnotationView = new ChooseAnnotationView({
            el: $("#ChooseAnnotationContainer")
        });
        $('#annotation-chooser ul').accordion();

        //make the first item expanded
        $('ul.accordion > li').addClass('active', 'true');
        $('ul.accordion > li > ul').css('display', 'block');


        $(window).resize(function(e){
            //trigger an event to redraw
            GlobalEvent.trigger("screen_changed");
        });

		    </script>

{% endblock %}
