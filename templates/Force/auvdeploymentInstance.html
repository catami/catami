{% extends "base.html" %}


{% block sidebar %}
  <div id="sidebar-nav" class="span3" style="padding-left:10px;">

    <h1>Deployment</h1>  
    <div class="well well-small" style="align:center;">

      <p class="lead">{{auvdeployment_object.short_name}}</p>
      <p>options</p>
    </div><!--/.well -->
    <div class="alert">
      <strong>Warning!</strong> This page loads slowly for large datasets. Please be patient.
    </div>
  </div>
{% endblock %}

{% block content_header %}
  <ul class="breadcrumb">
    <li><a href="/data/campaigns/">Campaign List</a> <span class="divider">></span></li>
    <li><a href="/data/campaigns/{{auvdeploymentObject.campaign.id}}">{{auvdeployment_object.campaign.short_name}}</a> <span class="divider">></span></li>
    <li class="active">{{auvdeployment_object.short_name}}</li>
  </ul>
{% endblock %}

{% block content %}

{% if auvdeployment_object %}
<table class="table table-striped">
  <thead>
    <tr>
      <th>Start Time</th>
      <th>End Time</th>
      <th>Min Depth</th>
      <th>Max Depth</th>
      <th>Mission Aim</th>
      <th>Transect Shape</th>
      <th>Distance Covered</th>
    </tr>
  </thead>
  <tbody>

        <tr>
          <td>{{auvdeployment_object.start_time_stamp}}</td>
          <td>{{auvdeployment_object.end_time_stamp}}</td>
          <td>{{auvdeployment_object.min_depth}}</td>
          <td>{{auvdeployment_object.max_depth}}</td>
          <td>{{auvdeployment_object.mission_aim}}</td>
          <td>{{auvdeployment_object.transect_shape}}</td>
          <td>{{auvdeployment_object.distance_covered}}</td>
        <tr>

  </tbody>
</table>
{% else %}
    <p>No auvdeployments are available.</p>
{% endif %}

 <div class="accordion" id="accordion1">
  <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapseOne">
        GeoJSON Data
      </a>
    </div>
    <div id="collapseOne" class="accordion-body collapse out">
      <div class="accordion-inner">
        {{deployment_as_geojson}}
      </div>
    </div>
  </div>
</div>


 <h3>AUV Deployment Data</h3>

{% if image_list %}
<ul class="nav nav-tabs" id="myTab">
  <li class="active"><a href="#list">Data List</a></li>
  <li><a href="#viewer">Map Viewer</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="viewer">
  	<div id='map_container2'></div>
  </div>
  <div class="tab-pane" id="list">
    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th>Left/Right Image</th>
          <th>Date</th>
          <th>Position</th>
          <th>Temp</th>
          <th>Salinity</th>
          <th>Pitch</th>
          <th>Roll</th>
          <th>Yaw</th>
          <th>Altitude</th>
          <th>Depth</th>
        </tr>
      </thead>
      <tbody>

          {% for image in image_list %}
            <tr>
              <td>
                <a class="btn" href="{{image.left_thumbnail_reference}}" > [L]<i class="icon-picture"></i></a>
                <a class="btn" href="{{image.right_thumbnail_reference}}" > [R]<i class="icon-picture"></i></a>
              </td>
              <td>{{image.date_time}}</v>
              <td>{{image.image_position}}</td>
              <td>{{image.temperature}}</td>
              <td>{{image.salinity}}</td>
              <td>{{image.pitch}}</td>
              <td>{{image.roll}}</td>
              <td>{{image.yaw}}</td>
              <td>{{image.altitude}}</td>
              <td>{{image.depth}}</td>
            <tr>

          {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
      <p>No imagery found for AUV Deployment.</p>
  {% endif %}


  <!-- Modal -->
  <div class="modal  fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="myModalLabel">Modal header</h3>
    </div>
    <div class="modal-body">
    </div>
  </div>​

 
    <!-- bootstrap-tab.js-->
    <script>
      $(function () {
        $('#myTab a:last').tab('show');
      })
    </script>

  <script type='text/javascript'>//<![CDATA[ 
  $(window).load(function(){
  $('a.btn').on('click', function(e) {
      e.preventDefault();
      var url = $(this).attr('href');
      $(".modal-body").html('<iframe width="100%" height="100%" frameborder="0" scrolling="no" allowtransparency="true" src="'+url+'"></iframe>');
  });
  });//]]>  
  </script>
  {% endblock %}

{% block add_script %}
    <script src='{{ STATIC_URL }}assets/openlayers/OpenLayers.js'> </script>
    <script src='{{ STATIC_URL }}assets/esriOceanBasemap/map.js'></script>
    
    <script type="text/javascript">
        var lon = 138;
        var lat = -35;
        var zoom = 4;
        var map, layer;

 function init(){
            map = new OpenLayers.Map( 'map_container2' );
            layer = new OpenLayers.Layer.WMS( "OpenLayers WMS", 
                    "http://vmap0.tiles.osgeo.org/wms/vmap0",
                    {layers: 'basic',numZoomLevels: 25} );
            map.addLayer(layer);
            map.setCenter(new OpenLayers.LonLat(lon, lat), zoom);
var geojson_data = '{ "type": "FeatureCollection", "features": [ {"geometry": { "type": "GeometryCollection", "geometries": [\
{% for image in image_list %}{% if not forloop.last %}{{image.image_position.geojson|safe}},{% else %}{{image.image_position.geojson|safe}}{% endif %}{% endfor %}] }, "type": "Feature", "properties": {}} ] }';
           
           var geojson_format = new OpenLayers.Format.GeoJSON();
           var featurecollection = geojson_format.read(geojson_data);
           
           var vector_layer = new OpenLayers.Layer.Vector(); 
           map.addLayer(vector_layer);
           vector_layer.addFeatures(geojson_format.read(geojson_data));

        }
    </script>
{% endblock %}